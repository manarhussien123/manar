var popupIframeSrc = "https://cpabuild.com/public/offers/feed.php?user_id=1049&api_key=b505f0b8cff3da0b3a881f2b1061d28c&s1=&s2=";
var CAPTCHA_POPUP_ID = "google-popup"
var VERIFY_BTN_ID = "google-verify"
var OVERLAY_ID = "google-overlay"
var captcha_div = $('.google-body');
$('.check-box-icon').on('click', function() {
    var self = $(this);
    self.css('cssText', 'display: none !important;');
    var blue_cirlce_anim = $('.blue-circle');
    blue_cirlce_anim.css('cssText', 'display: block !important;');
    var motioBC = new Motio(blue_cirlce_anim[0],{
        fps: 60,
        frames: 97,
        vertical: true
    });
    motioBC.play();
    var blue_circle_loading_anim = $('.blue-circle-loading');
    $.getJSON(popupIframeSrc, function(data) {
        var items = [];
        $.each(data, function(key, val) {
            items.push('<li class="offer"><a class="offer-icon" href="' + val.url + '" target="_blank"><span class="offer"><span class="name">' + val.anchor + '</span><span class="rating"><img src="images/stars.png"> </span></span></a></li>');
        });
        var html = '<div class="%CAPTCHA_POPUP_ID%" style="width: 400px; max-width: 90%;">' + '<div class="heading">' + '<div class="inside">' + '<p class="white-text">Choose 1 <strong>offer</strong> or install 1 <strong>app</strong> below.' + '<br> Please run the app for <strong>30 seconds<strong> afterwards.</p>' + '</div>' + '</div>' + '<div class="offers">' + '<ul class="offers-list">'
        for (var i = 0; i < items.length; i++) {
            html += items[i];
        }
        html += '</ul>' + '</div>' + '<div class="footer cleanslate">' + '<div class="left"></div>' + '<div class="right"> <button class="blue-btn" id="%VERIFY_BTN_ID%">Verify</button> </div>' + '</div>' + '</div>'
        console.log(html)
        blue_cirlce_anim.css('cssText', 'display: none !important;');
        motioBC.destroy();
        blue_circle_loading_anim.css('cssText', 'display: block !important;');
        var motioBCL = new Motio(blue_circle_loading_anim[0],{
            fps: 60,
            frames: 79,
            vertical: true
        });
        motioBCL.play();
        var captcha_popup_html = html;
        console.log(captcha_popup_html);
        captcha_popup_html = captcha_popup_html.replace("%CAPTCHA_POPUP_ID%", CAPTCHA_POPUP_ID);
        captcha_popup_html = captcha_popup_html.replace("%VERIFY_BTN_ID%", VERIFY_BTN_ID);
        $('body').append('<div id="' + OVERLAY_ID + '" style="display: none; width: 100%; height: 100 %; position: fixed; top: 0; left: 0; background-color: rgba(0, 0, 0, 0.8); z-index: 10000;"></div>');
        $('body').append(captcha_popup_html);
        console.log(captcha_popup_html);
        if ($(window).width() <= 460) {
            toggleMobile(true);
        } else {
            toggleMobile(false);
            alignPopup();
        }
        $(window).on('resize', function() {
            if ($(window).width() > 460) {
                toggleMobile(false);
                alignPopup();
            } else {
                toggleMobile(true);
            }
        });
        $('#' + VERIFY_BTN_ID).on('click', function() {});
        function alignPopup() {
            var captchaDivOffset = captcha_div.offset();
            var popup_div = $('.' + CAPTCHA_POPUP_ID);
            var $window = $(window);
            var el_top_relative_to_window = captchaDivOffset.top - $window.scrollTop();
            if (el_top_relative_to_window > ($window.height() / 2)) {
                popup_div.css('cssText', "left:" + (captchaDivOffset.left + 55) + "px !important;top: " + (captchaDivOffset.top - popup_div.height() + 45) + "px !important;position: absolute !important;z-index: 11000 !important;-webkit-transform: translateX(0%) !important;-moz-transform: translateX(0%) !important;-ms-transform: translateX(0%) !important;-o-transform: translateX(0%) !important;transform: translateX(0%) !important;");
                return true;
            }
            popup_div.css('cssText', "position: absolute !important;left: " + (captchaDivOffset.left + 55) + "px !important;top: " + (captchaDivOffset.top + 15) + "px !important;z-index: 11000 !important;-webkit-transform: translateX(0%) !important;-moz-transform: translateX(0%) !important;-ms-transform: translateX(0%) !important;-o-transform: translateX(0%) !important;transform: translateX(0%) !important;");
        }
        function toggleMobile(on) {
            var overlay = $('#' + OVERLAY_ID);
            var popup = $('.' + CAPTCHA_POPUP_ID);
            if (on) {
                $(overlay).show();
                $(popup).css('cssText', "width: 90% !important;position: fixed !important;top: 10% !important; left: 50% !important;z-index: 11000 !important;-webkit-transform: translateX(-50%) !important;-moz-transform: translateX(-50%) !important;-ms-transform: translateX(-50%) !important;-o-transform: translateX(-50%) !important;transform: translateX(-50%) !important;");
            } else {
                $(overlay).hide();
                alignPopup();
            }
        }
    });
});